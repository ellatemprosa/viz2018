install.packages("gapminder")
hold<-gapminder::gapminder_unfiltered
View(hold)
gapfiles<-list.file("C:\Users\bsc-default\Documents\gwstuff\visualexploration2018\gapminder")
gapfiles<-list.file("C:/Users/bsc-default/Documents/gwstuff/visualexploration2018/gapminder")
gapfiles<-list.files("C:/Users/bsc-default/Documents/gwstuff/visualexploration2018/gapminder")
gapfiles
gapfiles
gapdir<-"C:/Users/bsc-default/Documents/gwstuff/visualexploration2018/gapminder"
test<-rio::import(paste0(gapdir,'/',gapfiles[i]))
test<-rio::import(paste0(gapdir,'/',gapfiles[1]))
gapdir<-"C:/Users/bsc-default/Documents/gwstuff/visualexploration2018/gapminder"
gapfiles<-list.files(gapdir)
test<-rio::import(paste0(gapdir,'/',gapfiles[1]))
View(test)
colnames(test)[1]
testlong<-gather(test,key="year",value=colnames(test)[1])
testlong<-dplyr::gather(test,key="year",value=colnames(test)[1])
library(gapminder)
library(tidyverse)
testlong<-r::gather(test,key="year",value=colnames(test)[1])
testlong<-gather(test,key="year",value=colnames(test)[1])
View(testlong)
idx<-colnames(test)[1]
idx<-compress(colnames(test)[1])
idx<-gsub("[[:space:]]", "", colnames(test)[1])
testlong<-gather(test,key="year",value=idx)
View(testlong)
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)
View(testlong)
View(testlong)
View(test)
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)
View(testlong)
colnames(testlong)<-c("country","year",idx)
View(testlong)
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)%>%
mutate(year=as.numeric(year))
colnames(testlong)<-c("country","year",idx)
View(testlong)
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)%>%
filter(!is.na(idx)) %>%
mutate(year=as.numeric(year))
colnames(testlong)<-c("country","year",idx)
View(testlong)
gapdata<-NULL
for (i in 1:length(gapfiles)){
test<-rio::import(paste0(gapdir,'/',gapfiles[1]))
idx<-gsub("[[:space:]]", "", colnames(test)[1])
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)%>%
filter(!is.na(idx)) %>%
mutate(year=as.numeric(year))
colnames(testlong)<-c("country","year",idx)
if (i=1)
gapdata<-testlong
else
gapdata<-left_join(gapdata,testlong)
}
for (i in 1:length(gapfiles)){
test<-rio::import(paste0(gapdir,'/',gapfiles[1]))
idx<-gsub("[[:space:]]", "", colnames(test)[1])
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)%>%
filter(!is.na(idx)) %>%
mutate(year=as.numeric(year))
colnames(testlong)<-c("country","year",idx)
if (i=1){
gapdata<-testlong
}
else {
gapdata<-left_join(gapdata,testlong)
}
}
gapdata<-NULL
for (i in 1:length(gapfiles)){
test<-rio::import(paste0(gapdir,'/',gapfiles[1]))
idx<-gsub("[[:space:]]", "", colnames(test)[1])
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)%>%
filter(!is.na(idx)) %>%
mutate(year=as.numeric(year))
colnames(testlong)<-c("country","year",idx)
if (i=1){
gapdata<-testlong
}
else {
gapdata<-left_join(gapdata,testlong)
}
}
gapdata<-NULL
for (i in 1:length(gapfiles)){
test<-rio::import(paste0(gapdir,'/',gapfiles[1]))
idx<-gsub("[[:space:]]", "", colnames(test)[1])
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)%>%
filter(!is.na(idx)) %>%
mutate(year=as.numeric(year))
colnames(testlong)<-c("country","year",idx)
if (i==1){
gapdata<-testlong
}
else {
gapdata<-left_join(gapdata,testlong)
}
}
gapdata<-NULL
for (i in 1:length(gapfiles)){
test<-rio::import(paste0(gapdir,'/',gapfiles[i]))
idx<-gsub("[[:space:]]", "", colnames(test)[i])
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)%>%
filter(!is.na(idx)) %>%
mutate(year=as.numeric(year))
colnames(testlong)<-c("country","year",idx)
if (i==1){
gapdata<-testlong
}
else {
gapdata<-left_join(gapdata,testlong)
}
}
test<-rio::import(paste0(gapdir,'/',gapfiles[4]))
idx<-gsub("[[:space:]]", "", colnames(test)[4])
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)%>%
filter(!is.na(idx)) %>%
mutate(year=as.numeric(year))
colnames(testlong)<-c("country","year",idx)
if (i==1){
gapdata<-testlong
}
else {
gapdata<-left_join(gapdata,testlong)
}
View(testlong)
View(test)
test<-rio::import(paste0(gapdir,'/',gapfiles[4]))
View(test)
idx<-gsub("[[:space:]]", "", colnames(test)[4])
idx
test<-rio::import(paste0(gapdir,'/',gapfiles[4]))
idx<-gsub("[[:space:]]", "", colnames(test)[1])
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)%>%
filter(!is.na(idx)) %>%
mutate(year=as.numeric(year))
colnames(testlong)<-c("country","year",idx)
View(testlong)
if (i==1){
gapdata<-testlong
}
else {
gapdata<-left_join(gapdata,testlong)
}
for (i in 1:length(gapfiles)){
test<-rio::import(paste0(gapdir,'/',gapfiles[i]))
idx<-gsub("[[:space:]]", "", colnames(test)[1])
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)%>%
filter(!is.na(idx)) %>%
mutate(year=as.numeric(year))
colnames(testlong)<-c("country","year",idx)
if (i==1){
gapdata<-testlong
}
else {
gapdata<-left_join(gapdata,testlong)
}
}
View(gapdata)
View(gapdata)
gapfiles[5]
for (i in 1:length(gapfiles)){
test<-rio::import(paste0(gapdir,'/',gapfiles[i]))
idx<-gsub("[[:space:]]", "", colnames(test)[1])
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)%>%
filter(!is.na(idx)) %>%
mutate(year=as.numeric(year))
colnames(testlong)<-c("country","year",idx)
if (i==1){
gapdata<-testlong
}
else {
gapdata<-left_join(gapdata,testlong)
}
}
View(gapdata)
?save
save(gapdata,file="gapdata.Rdata")
View(gapdata)
rio::export(gapdata,file="gapdata.xlsx")
library(gapminder)
library(tidyverse)
# hold<-gapminder::gapminder_unfiltered too little data
gapdir<-paste(getwd(),"gapminder")
gapfiles<-list.files(gapdir)
gapdata<-NULL
for (i in 1:length(gapfiles)){
test<-rio::import(paste0(gapdir,'/',gapfiles[i]))
idx<-gsub("[[:space:]]", "", colnames(test)[1])
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)%>%
filter(!is.na(idx)) %>%
mutate(year=as.numeric(year))
colnames(testlong)<-c("country","year",idx)
if (i==1){
gapdata<-testlong
}
else {
gapdata<-left_join(gapdata,testlong)
}
}
rio::export(gapdata,file="gapdata.xlsx")
gapdir<-paste(getwd(),"/gapminder")
gapfiles<-list.files(gapdir)
gapdata<-NULL
for (i in 1:length(gapfiles)){
test<-rio::import(paste0(gapdir,'/',gapfiles[i]))
idx<-gsub("[[:space:]]", "", colnames(test)[1])
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)%>%
filter(!is.na(idx)) %>%
mutate(year=as.numeric(year))
colnames(testlong)<-c("country","year",idx)
if (i==1){
gapdata<-testlong
}
else {
gapdata<-left_join(gapdata,testlong)
}
}
rio::export(gapdata,file="gapdata.xlsx")
#gap minder
library(gapminder)
library(tidyverse)
# hold<-gapminder::gapminder_unfiltered too little data
gapdir<-paste(getwd(),"/gapminder")
gapfiles<-list.files(gapdir)
gapdata<-NULL
for (i in 1:length(gapfiles)){
test<-rio::import(paste0(gapdir,'/',gapfiles[i]))
idx<-gsub("[[:space:]]", "", colnames(test)[1])
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)%>%
filter(!is.na(idx)) %>%
mutate(year=as.numeric(year))
colnames(testlong)<-c("country","year",idx)
if (i==1){
gapdata<-testlong
}
else {
gapdata<-left_join(gapdata,testlong)
}
}
rio::export(gapdata,file="gapdata.xlsx")
gapdir<-paste(getwd(),"/gapminder")
gapfiles<-list.files(gapdir)
gapdir
gapdir<-paste0(getwd(),"/gapminder")
gapfiles<-list.files(gapdir)
gapdata<-NULL
for (i in 1:length(gapfiles)){
test<-rio::import(paste0(gapdir,'/',gapfiles[i]))
idx<-gsub("[[:space:]]", "", colnames(test)[1])
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)%>%
filter(!is.na(idx)) %>%
mutate(year=as.numeric(year))
colnames(testlong)<-c("country","year",idx)
if (i==1){
gapdata<-testlong
}
else {
gapdata<-left_join(gapdata,testlong)
}
}
rio::export(gapdata,file="gapdata.xlsx")
for (i in 1:length(gapfiles)){
# import data one at a time
test<-rio::import(paste0(gapdir,'/',gapfiles[i]))
# figure out indicator for file
idx<-gsub("[[:space:]]", "", colnames(test)[1])
# reshape data to be long, a row for each country, year
testlong<-gather(test,c(colnames(test)[-1]),key="year",value=idx)%>%
filter(!is.na(idx)) %>%
mutate(year=as.numeric(year))
# rename columns properly
colnames(testlong)<-c("country","year",idx)
# combine accumulating indices
if (i==1){
gapdata<-testlong
}
else {
gapdata<-full_join(gapdata,testlong)
}
}
rio::export(gapdata,file="gapdata.xlsx")
View(gapdata)
